<!--
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Autumn Moulios ~ Ethan Nguyen ~ 4/25/2021 ~ CSE 160
// amoulios
// etqnguye
// 
// Assignment 4
// Camera Movement
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Program 5: Three.js</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<script src="../lib/three.js"></script>
        <script src="../lib/OrbitControls.js"></script>
		<script>
            let scene, camera, controls, renderer, cube, bulb, lightMaterial;

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

			init();
            window.addEventListener('resize', onWindowResize, false);
            animate(); //hey 2
            
            function init() {
                // rendering settings
                renderer = new THREE.WebGLRenderer();
                renderer.physicallyCorrectLights = true;
				renderer.outputEncoding = THREE.sRGBEncoding;
				renderer.shadowMap.enabled = true;
				renderer.toneMapping = THREE.ReinhardToneMapping;
				renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );

                // camera setup
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 2000);
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                camera.position.z = 5;
                controls.update();

                // cube
                const cubeGeometry = new THREE.SphereGeometry(1, 15, 15);
                const cubeMaterial = new THREE.MeshPhongMaterial( { color: 0x00ff00 } );
                cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
                cube.castShadow = true;
                scene.add(cube);

                // plane
                const planeGeometry = new THREE.PlaneGeometry(1000, 1000);
                const planeMaterial = new THREE.MeshPhongMaterial({color: 0xff0000});
                plane = new THREE.Mesh(planeGeometry, planeMaterial);
                plane.receiveShadow = true;
                plane.rotation.x = - Math.PI / 2;
                plane.position.y = -1;
                scene.add(plane);

                // lighting
                lightGeometry = new THREE.SphereGeometry(0.02, 16, 16);
                bulb = new THREE.PointLight(0xffffff, 1, 200, 2);
                lightMaterial = new THREE.MeshPhongMaterial( {
                    emissive: 0xffffee,
                    emissiveIntensity: 1,
                    color: 0x000000
                } );
                bulb.add(new THREE.Mesh(lightGeometry, lightMaterial));
                bulb.position.set(0, 2, 2);
                bulb.castShadow = true;
                scene.add(bulb);

                // skybox
                let materialArray = [];
                let texture_ft = new THREE.TextureLoader().load( 'corona_ft.jpg');
                let texture_bk = new THREE.TextureLoader().load( 'corona_bk.jpg');
                let texture_up = new THREE.TextureLoader().load( 'corona_up.jpg');
                let texture_dn = new THREE.TextureLoader().load( 'corona_dn.jpg');
                let texture_rt = new THREE.TextureLoader().load( 'corona_rt.jpg');
                let texture_lf = new THREE.TextureLoader().load( 'corona_lf.jpg');

                materialArray.push(new THREE.MeshBasicMaterial( { map: texture_ft }));
                materialArray.push(new THREE.MeshBasicMaterial( { map: texture_bk }));
                materialArray.push(new THREE.MeshBasicMaterial( { map: texture_up }));
                materialArray.push(new THREE.MeshBasicMaterial( { map: texture_dn }));
                materialArray.push(new THREE.MeshBasicMaterial( { map: texture_rt }));
                materialArray.push(new THREE.MeshBasicMaterial( { map: texture_lf }));

                for (let i = 0; i < 6; i++) 
                    materialArray[i].side = THREE.BackSide;

                let skyboxGeo = new THREE.BoxGeometry( 10000, 10000, 10000);
                let skybox = new THREE.Mesh( skyboxGeo, materialArray );
                scene.add( skybox );  
               
                const ambient = new THREE.AmbientLight(0x404040);
                scene.add(ambient);
            }

            function animate() {
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;

	            requestAnimationFrame( animate );
	            render();
            }

            function render() {
                renderer.toneMappingExposure = Math.pow(0.68, 5.0); // to allow for very bright scenes.
				renderer.shadowMap.enabled = true;
				bulb.castShadow = true;

				bulb.power = 400;
				lightMaterial.emissiveIntensity = bulb.intensity / Math.pow(0.02, 2.0); // convert from intensity to irradiance at bulb surface
                
                renderer.render( scene, camera );
            }
            
		</script>
	</body>
</html>